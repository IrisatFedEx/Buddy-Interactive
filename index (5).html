<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buddy Interactive</title>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#1f2430;
      --muted:#6b7280;
      --accent:#4d148c;
      --accent-2:#ff6600;
      --shadow: 0 10px 24px rgba(0,0,0,0.07), 0 2px 6px rgba(0,0,0,0.05);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      font-family:'Assistant', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .wrap{
      width:min(900px, 100%);
      display:grid; gap:18px;
      grid-template-rows:auto 1fr auto;
      min-height:560px;
    }
    header{
      display:grid; gap:10px; place-items:center; text-align:center;
    }
    .title{
      font-weight:800; letter-spacing:.2px; font-size:clamp(22px, 2.6vw, 30px);
    }
    .controls{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    button{
      appearance:none; border:1px solid #e5e7eb; background:#fff; color:var(--text);
      padding:.6rem .9rem; border-radius:12px; font-weight:800; font-size:14px; cursor:pointer;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .06s ease, box-shadow .2s ease, border-color .2s ease;
    }
    button:hover{ box-shadow:var(--shadow); transform:translateY(-1px); }
    button:active{ transform:translateY(0); }
    button.primary{ background:var(--accent); color:#fff; border-color:transparent; }
    button.secondary{ background:#fff; color:var(--accent); border-color:rgba(77,20,140,.25); }
    button.ghost{ background:transparent; border-color:transparent; color:var(--muted); }

    .deck{ position:relative; display:grid; place-items:center; }
    .card{
      width:min(820px, 100%);
      min-height:430px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid #edeef3;
      position:relative;
      padding: clamp(16px, 3.2vw, 28px);
      overflow:hidden;
    }
    .card::before,
    .card::after{
      content:""; position:absolute; left:0; right:0; height:14px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      z-index:2;
    }
    .card::before{ top:0; }
    .card::after{ bottom:0; }

    .face{
      position:absolute; inset:0; padding:clamp(16px, 3.2vw, 28px);
      background:transparent; z-index:1;
    }
    .front{ opacity:1; transition:opacity .28s ease; }
    .back{ opacity:0; pointer-events:none; transition:opacity .28s ease; }
    .card.show-back .front{ opacity:0; pointer-events:none; }
    .card.show-back .back{ opacity:1; pointer-events:auto; }

    .front-center{
      position:absolute; top:50%; left:50%;
      transform:translate(-50%, -50%);
      width:min(700px, 90%);
      display:flex; flex-direction:column; align-items:center; gap:14px;
      text-align:center;
    }
    .lead{ font-size:clamp(22px, 3vw, 30px); font-weight:800; color:var(--accent); }
    .q{ font-size:clamp(22px, 3.2vw, 32px); line-height:1.5; font-weight:800; color:var(--accent-2); }
    .divider{ height:2px; width:160px; background:rgba(77,20,140,0.15); }

    .back{ padding:0; }
    .mantra{
      position:absolute; inset:0;
      display:grid; place-items:center;
      text-align:center;
      font-weight:900;
      font-size:clamp(34px, 5vw, 54px);
      letter-spacing:.3px;
      color:#fff;
      padding:24px;
    }
    .bg-purple{ background:var(--accent); }
    .bg-orange{ background:var(--accent-2); }

    .meta{
      position:absolute; left:50%; bottom:18px; transform:translateX(-50%);
      display:flex; align-items:center; justify-content:center; gap:10px;
      color:var(--muted); font-size:14px;
      width:90%;
    }
    .progress{
      height:10px; flex: 0 0 min(600px, 92%); background:#ececf4; border-radius:999px; overflow:hidden;
      box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
    }
    .bar{height:100%; width:0; background:linear-gradient(90deg, var(--accent), var(--accent-2));}

    footer{
      display:grid; place-items:center; color:var(--muted); text-align:center;
    }
    .hint{ font-size:12px;}
    .kbd{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background:#fff; border:1px solid #e5e7eb; padding:.1rem .3rem; border-radius:6px; box-shadow:0 1px 0 rgba(0,0,0,.02);
    }

    .swap{ animation: swapOnce .5s ease both; }
    @keyframes swapOnce{
      0%{ opacity:0; transform: translateZ(0) rotateX(-8deg); }
      100%{ opacity:1; transform: translateZ(0) rotateX(0deg); }
    }

    .overlay{ position:absolute; inset:0; display:grid; place-items:center; text-align:center; z-index:3; }
    .is-hidden{ display:none !important; }
    .splash-inner{
      display:grid; gap:14px; place-items:center;
      width:100%; height:100%;
      background: radial-gradient(1200px 600px at 50% 30%, rgba(77,20,140,0.08), transparent),
                  radial-gradient(1000px 500px at 50% 70%, rgba(255,102,0,0.08), transparent);
    }
    .splash-title{ font-size:clamp(36px, 5.4vw, 64px); font-weight:900; letter-spacing:.4px; color:var(--accent); }
    .splash-sub{ font-size:clamp(22px, 3.2vw, 36px); font-weight:800; color:var(--accent-2); }
    .splash-art{ display:grid; grid-auto-flow:column; gap:8px; }
    .tile{ width:18px; height:18px; border-radius:4px; background:linear-gradient(90deg, var(--accent), var(--accent-2)); opacity:.9; }

    .finale-inner{
      width:100%; height:100%; display:grid; place-items:center;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#fff; font-weight:900; font-size:clamp(28px, 4.2vw, 50px);
      letter-spacing:.3px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Buddy Interactive</div>
      <div class="controls">
        <button id="prevBtn" aria-label="Previous">â—€ Prev</button>
        <button id="nextBtn" class="secondary" aria-label="Next">Next â–¶</button>
        <button id="shuffleBtn" class="ghost" aria-label="Shuffle">Shuffle</button>
        <button id="flipBtn" class="primary" aria-label="Flip">Flip</button>
      </div>
    </header>

    <section class="deck">
      <div class="card" id="card">
        <div class="face front" id="frontFace">
          <div class="front-center">
            <div class="lead" id="lead"></div>
            <div class="divider"></div>
            <div class="q" id="q"></div>
          </div>
          <div class="meta">
            <div id="counter"></div>
            <div class="progress"><div class="bar" id="bar"></div></div>
          </div>
          <!-- Splash -->
          <div class="overlay splash" id="splash">
            <div class="splash-inner">
              <div class="splash-art">
                <span class="tile"></span><span class="tile"></span><span class="tile"></span><span class="tile"></span><span class="tile"></span>
              </div>
              <div class="splash-title">Buddy Interactive</div>
              <div class="splash-sub">Inspiration game</div>
            </div>
          </div>
          <!-- Finale -->
          <div class="overlay finale is-hidden" id="finale">
            <div class="finale-inner">ðŸ’œ Keep inspiring each other</div>
          </div>
        </div>
        <div class="face back">
          <div class="mantra bg-purple" id="mantra">Follow your dreams</div>
        </div>
      </div>
    </section>

    <footer>
      <div class="hint"><span class="kbd">Space</span> = Flip, <span class="kbd">&#8592;</span>/<span class="kbd">&#8594;</span> = Prev/Next, <span class="kbd">S</span> = Shuffle</div>
    </footer>
  </div>

  <script>
    const items = [
      { lead:"×›×©×ž×§×©×™×‘×™× ×‘××ž×ª â€“ ×œ×•×ž×“×™×.", q:"××™×–×• ×ª×•×‘× ×” ×§×™×‘×œ×ª ×ž×¢×•×‘×“ ×—×“×© ×©×–×›×•×¨×” ×œ×š ×‘×ž×™×•×—×“?" },
      { lead:"×¨×’×¢×™× ×§×˜× ×™× ×¢×•×©×™× ××ª ×”×™×•×.", q:"×œ×ž×™ ×”×™×™×ª ×¨×•×¦×” ×œ×¤×¨×’×Ÿ ×¢×œ ×ž×©×”×• ×§×˜×Ÿ ×©×¢×©×” ×œ×š ×˜×•×‘ ×”×©×‘×•×¢?" },
      { lead:"×›×œ ×ž×¤×’×© ×¢× ×¢×•×‘×“ ×—×“×© ×”×•× ×”×–×“×ž× ×•×ª ×œ×”×©×¤×™×¢ ×œ×˜×•×‘×”.", q:"×ž×” ×”×“×‘×¨ ×”×§×˜×Ÿ ×©××ª/×” ×¢×•×©×” ×›×“×™ ×œ×’×¨×•× ×œ×¢×•×‘×“×™× ×—×“×©×™× ×œ×”×¨×’×™×© ×‘× ×•×— ×›×‘×¨ ×ž×”×™×•× ×”×¨××©×•×Ÿ?" },
      { lead:"×œ×¤×¢×ž×™× ×“×•×•×§× ×”×ž×—×•×•×” ×”×§×˜× ×” ×–×›×•×¨×” ×”×›×™ ×˜×•×‘.", q:"××™×–×” ×¨×’×¢ ×§×œ×™×˜×” ×ž×¨×’×© ××• ×ž×¦×—×™×§ ××ª/×” ×–×•×›×¨/×ª ×‘×ž×™×•×—×“?" },
      { lead:"×‘××“×™ ×˜×•×‘ ×”×•× ×œ× ×¨×§ ×ž×“×¨×™×š â€“ ×”×•× ××“× ×©×ž×§×©×™×‘ ×‘××ž×ª.", q:"××™×š ××ª/×” ×’×•×¨×/×ª ×œ×¢×•×‘×“ ×”×—×“×© ×œ×”×¨×’×™×© × ×•×— ×œ×©×ª×£ ××•×ª×š?" },
      { lead:"×˜×¢×•×™×•×ª ×”×Ÿ ×—×œ×§ ×ž×”×œ×ž×™×“×”.", q:"×¡×¤×¨/×™ ×¢×œ ×˜×¢×•×ª ×©×œ×™×ž×“×” ××•×ª×š ×ž×©×”×• ×—×©×•×‘ ×ž×§×¦×•×¢×™×ª." },
      { lead:"×× ×©×™× ×–×•×›×¨×™× ××™×š ×’×¨×ž× ×• ×œ×”× ×œ×”×¨×’×™×©.", q:"×ž×ª×™ ×§×™×‘×œ×ª ×©×™×¨×•×ª ×ž×¦×•×™×Ÿ â€” ×•×ž×” ×œ×§×—×ª ×ž×–×” ×œ×¢×‘×•×“×” ×©×œ×š?" },
      { lead:"×™×© ×‘××“×™×– ×©××•×”×‘×™× ×œ×ª×›× ×Ÿ ×”×›×•×œ ×ž×¨××©, ×•×™×© ×›××œ×” ×©×–×•×¨×ž×™×.", q:"××™×š ××ª/×” ×ž×•×¦×/×ª ××ª ×”××™×–×•×Ÿ ×‘×™×Ÿ ×ª×›× ×•×Ÿ ×œ×©×™×—×” ×˜×‘×¢×™×ª?" },
      { lead:"×©××œ×•×ª ×˜×•×‘×•×ª ×ž×™×™×¦×¨×•×ª ×œ×ž×™×“×”.", q:"××™×–×• ×©××œ×” ×”×™×™×ª ×¨×•×¦×” ×œ×©××•×œ ×§×•×œ×’×” ×•×ª×ž×™×“ ×“×—×™×ª?" },
      { lead:"×©×’×¨×•×ª ×™×•×¦×¨×•×ª ×‘×™×˜×—×•×Ÿ.", q:"××™×–×” ×”×¨×’×œ ×™×•×ž×™ ×§×¦×¨ ×¢×•×–×¨ ×œ×š ×œ×¤×ª×•×— ××ª ×”×™×•× ×‘×¤×•×§×•×¡?" },
      { lead:"×ª×ž×™×›×” ××ž×™×ª×™×ª ×œ× × ×ž×“×“×ª ×‘×–×ž×Ÿ â€“ ××œ× ×‘×›×•×•× ×”.", q:"××™×š ××ª/×” ×©×•×ž×¨/×ª ×¢×œ ×§×©×¨ ×¢× ×”×¢×•×‘×“ ×’× ××—×¨×™ ×©×”×•× ×›×‘×¨ ×”×©×ª×œ×‘?" },
      { lead:"×’× ×‘××“×™ ×¦×¨×™×š ×‘××“×™.", q:"×œ×ž×™ ××ª/×” ×¤×•× ×” ×›×©××ª/×” ×¨×•×¦×” ×œ×©×ª×£ ××• ×œ×”×ª×™×™×¢×¥?" },
      { lead:"×§×œ×™×˜×” ×˜×•×‘×” ×”×™× ×œ× ×¨×§ ××—×¨×™×•×ª ×©×œ ×‘××“×™ ××—×“.", q:"××™×š ××ª/×” ×ž×¢×¨×‘/×ª ××—×¨×™× ×‘×ª×”×œ×™×š ×”×§×œ×™×˜×”?" },
      { lead:"×©×¤×” ×ž×©×•×ª×¤×ª ×ž×§×¦×¨×ª ×ª×”×œ×™×›×™×.", q:"××™×–×” ×ž×•×©×’ ×¤× ×™×ž×™ ××• ×§×™×¦×•×¨ ×ž×‘×œ×‘×œ ××•×ª×š ××• ×“×¨×© ×ž×ž×š ×–×ž×Ÿ ×œ×”×‘×™×Ÿ?" },
      { lead:"××™×–×•×Ÿ ×™×•×¦×¨ ×× ×¨×’×™×” ×˜×•×‘×”.", q:"×ž×” × ×•×ª×Ÿ ×œ×š ×“×œ×§ ×‘××ž×¦×¢ ×”×™×•× â€” ×”×œ×™×›×” ×§×¦×¨×”, ×ž×•×–×™×§×”, ××• ×ž×©×”×• ××—×¨?" },
      { lead:"×›×œ ×§×œ×™×˜×” ×ž×œ×ž×“×ª ×’× ××ª ×”×‘××“×™ ×ž×©×”×• ×—×“×©.", q:"×ž×” ×’×™×œ×™×ª ×¢×œ ×¢×¦×ž×š ×ž××– ×©×”×ª×—×œ×ª ×œ×œ×•×•×ª ×¢×•×‘×“×™×?" },
      { lead:"×§×œ×™×˜×” ×”×™× ×œ× ×¨×§ ×ž×™×“×¢ â€“ ×”×™× ×—×•×•×™×”.", q:"×ž×” ××ª/×” ×¢×•×©×” ×›×“×™ ×œ×”×¤×•×š ××ª ×”×™×ž×™× ×”×¨××©×•× ×™× ×œ×™×•×ª×¨ ×§×œ×™× ××• ×›×™×¤×™×™×?" },
      { lead:"×‘××“×™ ×”×•× ×”×¤× ×™× ×”×¨××©×•× ×•×ª ×©×œ ×”×—×‘×¨×”.", q:"××™×š ××ª/×” ×ž× ×¡×” ×œ×©×§×£ ××ª ×”×ª×¨×‘×•×ª ×•×”×¢×¨×›×™× ×©×œ× ×• ×“×¨×š ×”×“×¨×š ×©×‘×” ××ª/×” ×ž×œ×•×•×”?" },
      { lead:"×ž×©×•×‘ ×”×•× ×ž×ª× ×”, ×’× ×œ×‘××“×™.", q:"××™×–×” ×ž×©×•×‘ ×©×§×™×‘×œ×ª ×ž×¢×•×‘×“ ×—×“×© ×”×©×¤×™×¢ ×¢×œ×™×š?" },
      { lead:"×œ×¤×¢×ž×™× ×’× ×‘××“×™ × ×‘×•×š.", q:"×ž×ª×™ ×”×¨×’×©×ª ×¤×—×•×ª ×‘×˜×•×—/×” ×‘×ª×¤×§×™×“ â€“ ×•××™×š ×”×ª×ž×•×“×“×ª?" },
      { lead:"×›×©×™×© ××ž×•×Ÿ â€“ ×”×›×•×œ ×™×•×ª×¨ ×§×œ.", q:"××™×š ××ª/×” ×‘×•× ×” ××ž×•×Ÿ ×¢× ×ž×™×©×”×• ×©×¢×“×™×™×Ÿ ×›×ž×¢×˜ ×œ× ×ž×›×™×¨ ××•×ª×š?" },
      { lead:"×¨×’×¢×™ ×”×¦×œ×—×” × ×•×ª× ×™× ×›×•×—.", q:"×¡×¤×¨/×™ ×¢×œ ×”×¦×œ×—×” ×§×˜× ×” ×©×œ×š ×›×‘××“×™ ×©×’×¨×ž×” ×œ×š ×œ×—×™×™×š." },
      { lead:"×œ×›×œ ××—×“ ×™×© ×¡×’× ×•×Ÿ ×‘××“×™×•×ª ××—×¨.", q:"××™×š ×”×™×™×ª ×ž×’×“×™×¨/×” ××ª ×”â€œ×‘××“×™-×¡×˜×™×™×œâ€ ×©×œ×š ×‘×©×œ×•×© ×ž×™×œ×™×?" },
      { lead:"×’× ×©×™×—×•×ª ×§×˜× ×•×ª ×”×Ÿ ×’×©×¨×™× ×’×“×•×œ×™×.", q:"×¢×œ ×ž×” ××ª/×” ××•×”×‘/×ª ×œ×“×‘×¨ ×¢× ×¢×•×‘×“ ×—×“×© ×—×•×¥ ×ž×¢× ×™×™× ×™ ×¢×‘×•×“×”?" },
      { lead:"×›×œ ×‘××“×™ ×”×•× ×©×’×¨×™×¨ ×©×œ ×× ×¨×’×™×” ×˜×•×‘×”.", q:"×ž×” ×”×“×‘×¨ ×©××ª/×” ×”×›×™ ×’××” ×‘×• ×‘×¡×‘×™×‘×ª ×”×¢×‘×•×“×” ×©×œ× ×•?" },
      { lead:"×¡×™×•× ×§×œ×™×˜×” ×”×•× ×œ× ×¡×•×£, ××œ× ×”×ª×—×œ×” ×©×œ ×§×©×¨.", q:"××™×š ××ª/×” ×ž×ž×©×™×š/×” ×œ×©×ž×•×¨ ×¢×œ ×§×©×¨ ××—×¨×™ ×©×”×¢×•×‘×“ ×›×‘×¨ â€œ×¤×—×•×ª ×¦×¨×™×šâ€ ××•×ª×š?" },
      { lead:"×™×•× ×˜×•×‘ ×ž×ª×—×™×œ ×‘××•×•×™×¨×” ×˜×•×‘×”.", q:"×ž×” ×¢×•×–×¨ ×œ×š ×œ×¤×ª×•×— ××ª ×”×™×•× ×‘×× ×¨×’×™×•×ª ×˜×•×‘×•×ª?" },
      { lead:"×›×•×œ× ×• ×¦×¨×™×›×™× ×¨×’×¢ ×œ× ×©×•×.", q:"××™×š ××ª/×” ×˜×•×¢×Ÿ/×ª ×ž×¦×‘×¨×™× ×‘××ž×¦×¢ ×™×•× ×œ×—×•×¥?" },
      { lead:"×ª×ž×™×“ ×™×© ××ª ×”××“× ×”×–×” ×©×ž×¨×™× ××ª ×”××•×•×™×¨×”.", q:"×ž×™ ×–×” ××¦×œ×š ×‘×¢×‘×•×“×” â€“ ×•××™×š ××ª/×” ×¢×•×©×” ××ª ×–×” ×œ××—×¨×™×?" },
      { lead:"×’× ×™×•× ×¢×ž×•×¡ ×¢×•×‘×¨ ×™×•×ª×¨ ×‘×§×œ×•×ª ×›×©×™×© ×ž×™×©×”×• ×œ×“×‘×¨ ××™×ª×•.", q:"×¢× ×ž×™ ××ª/×” ×”×›×™ ××•×”×‘/×ª ×œ×”×ª×™×™×¢×¥ ××• ×œ×©×ª×£?" },
      { lead:"×›×•×œ× ×• ×œ×•×ž×“×™× ×›×œ ×”×–×ž×Ÿ â€“ ×’× ×‘×œ×™ ×œ×©×™× ×œ×‘.", q:"×ž×” ×œ×ž×“×ª ×œ××—×¨×•× ×” ×‘×¢×‘×•×“×” (×’× ×× ×–×” ×ž×©×”×• ×§×˜×Ÿ)?" },
      { lead:"×¤×¨×’×•×Ÿ ×§×˜×Ÿ ×¢×•×©×” ×”×‘×“×œ ×’×“×•×œ.", q:"×œ×ž×™ ×”×™×™×ª ×¨×•×¦×” ×œ×¤×¨×’×Ÿ ×¢×›×©×™×•?" },
      { lead:"×’× ×× ×”×›×•×œ ×¨×¥ â€“ ×©×•×•×” ×œ×¢×¦×•×¨ ×¨×’×¢.", q:"×¢×œ ×ž×” ××ª/×” ×’××” ×‘×¢×¦×ž×š ×‘×–×ž×Ÿ ×”××—×¨×•×Ÿ?" },
      { lead:"×”×©×¨××” ×œ×¤×¢×ž×™× ×ž×’×™×¢×” ×ž×ž×§×•× ×œ× ×¦×¤×•×™.", q:"×ž×” ××• ×ž×™ × ×ª×Ÿ ×œ×š ×”×©×¨××” ×”×©×‘×•×¢?" },
      { lead:"×ž× ×˜×•×¨ ×˜×•×‘ ×’×•×¨× ×œ×š ×œ×¨×¦×•×ª ×œ×”×™×•×ª ×›×ž×•×”×•.", q:"×ž×™ ×”×™×” ×ž×•×“×œ ×”×©×¨××” ×¢×‘×•×¨×š â€” ×’× ×× ×œ× ×§×¨××ª ×œ×• â€œ×ž× ×˜×•×¨â€?" },
      { lead:"×œ×¤×¢×ž×™× ×”×§×©×‘×” ××—×ª ×©×•×•×” ×™×•×ª×¨ ×ž×¤×ª×¨×•×Ÿ.", q:"×ž×ª×™ ×œ××—×¨×•× ×” ×¨×§ ×”×§×©×‘×ª â€” ×‘×œ×™ ×œ×”×¦×™×¢ ×¤×ª×¨×•×Ÿ?" }
    ];

    const mantras = [
      "Follow your dreams","Breathe","Keep Going","Make it happen","Smile","Enjoy the moment",
      "Be kind","Stay curious","Choose happiness","Shine bright","Let it go","Live Fully","Just dance","Believe in yourself"
    ];

    const card = document.getElementById('card');
    const frontFace = document.getElementById('frontFace');
    const lead = document.getElementById('lead');
    const q = document.getElementById('q');
    const counter = document.getElementById('counter');
    const bar = document.getElementById('bar');
    const mantraEl = document.getElementById('mantra');
    const splash = document.getElementById('splash');
    const finale = document.getElementById('finale');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const flipBtn = document.getElementById('flipBtn');

    let idx = 0;
    let mantraIdx = 0;
    let showingBack = false;
    let showFinale = false;
    let showSplash = true;

    function updateProgress(){
      if(showSplash){
        counter.textContent = `Start â€¢ 0 / ${items.length}`;
        bar.style.width = '0%';
      } else if(showFinale){
        counter.textContent = 'End';
        bar.style.width = '100%';
      } else {
        counter.textContent = `${idx+1} / ${items.length}`;
        bar.style.width = (((idx+1)/items.length)*100) + '%';
      }
    }

    function render(){
      splash.classList.toggle('is-hidden', !showSplash);
      finale.classList.toggle('is-hidden', !showFinale);
      if(showSplash || showFinale){
        lead.textContent = '';
        q.textContent = '';
      } else {
        const it = items[idx];
        lead.textContent = it.lead;
        q.textContent = it.q;
      }
      updateProgress();
    }

    function playSwap(){
      frontFace.classList.remove('swap');
      void frontFace.offsetWidth;
      frontFace.classList.add('swap');
      setTimeout(()=> frontFace.classList.remove('swap'), 520);
    }

    function setMantra(){
      mantraEl.textContent = mantras[mantraIdx % mantras.length];
      mantraEl.classList.remove('bg-purple','bg-orange');
      const pickPurple = Math.random() < 0.5;
      mantraEl.classList.add(pickPurple ? 'bg-purple' : 'bg-orange');
    }

    function flip(){
      if(showSplash || showFinale) return;
      mantraIdx = (mantraIdx + 1) % mantras.length;
      setMantra();
      showingBack = !showingBack;
      card.classList.toggle('show-back', showingBack);
    }

    function next(){
      if(showingBack){ showingBack=false; card.classList.remove('show-back'); }
      if(showSplash){ showSplash=false; idx=0; render(); playSwap(); return; }
      if(showFinale){ showFinale=false; idx=0; render(); playSwap(); return; }
      if(idx === items.length - 1){
        showFinale = true;
        render();
        return;
      }
      idx = idx + 1;
      render();
      playSwap();
    }

    function prev(){
      if(showingBack){ showingBack=false; card.classList.remove('show-back'); }
      if(showSplash){ return; }
      if(showFinale){ showFinale=false; idx = items.length - 1; render(); playSwap(); return; }
      if(idx === 0){ showSplash = true; render(); return; }
      idx = idx - 1;
      render();
      playSwap();
    }

    function shuffle(){
      if(showingBack){ showingBack=false; card.classList.remove('show-back'); }
      showFinale = false;
      showSplash = false;
      for(let i = items.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [items[i], items[j]] = [items[j], items[i]];
      }
      idx = 0;
      render();
      playSwap();
    }

    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);
    shuffleBtn.addEventListener('click', shuffle);
    flipBtn.addEventListener('click', flip);

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') next();
      else if(e.key === 'ArrowLeft') prev();
      else if(e.key.toLowerCase() === 's') shuffle();
      else if(e.code === 'Space'){ e.preventDefault(); flip(); }
    });

    render();
    setMantra();
  </script>
</body>
</html>
